groups:
  - name: container-alerts
    rules:

    ## üî• 1. Container d·ª´ng h·∫≥n (ng·ª´ng scrape)
    - alert: ContainerDown
      expr: up{job="cadvisor"} == 0
      for: 30s
      labels:
        severity: critical
      annotations:
        summary: "Container b·ªã down"
        description: "Prometheus kh√¥ng th·ªÉ scrape metrics t·ª´ cAdvisor."

    ## ‚ö†Ô∏è 2. Container restart qu√° nhi·ªÅu (crash loop)
    - alert: ContainerFrequentRestarts
      expr: rate(container_start_time_seconds[5m]) > 3
      for: 1m
      labels:
        severity: warning
      annotations:
        summary: "Container kh·ªüi ƒë·ªông l·∫°i qu√° nhi·ªÅu"
        description: "Container ƒëang restart h∆°n 3 l·∫ßn trong 5 ph√∫t g·∫ßn nh·∫•t."

    ## ‚ö†Ô∏è 3. Container d√πng qu√° nhi·ªÅu CPU (> 80%)
    - alert: HighContainerCPU
      expr: rate(container_cpu_usage_seconds_total[2m]) * 100 > 80
      for: 1m
      labels:
        severity: warning
      annotations:
        summary: "CPU container cao"
        description: "S·ª≠ d·ª•ng CPU trong container v∆∞·ª£t ng∆∞·ª°ng 80%."

    ## ‚ö†Ô∏è 4. Container d√πng qu√° nhi·ªÅu b·ªô nh·ªõ (> 80%)
    - alert: HighContainerMemory
      expr: (container_memory_usage_bytes / container_spec_memory_limit_bytes) > 0.8
      for: 1m
      labels:
        severity: warning
      annotations:
        summary: "Memory container cao"
        description: "S·ª≠ d·ª•ng b·ªô nh·ªõ trong container v∆∞·ª£t ng∆∞·ª°ng 80%."

    ## üî• 5. Container kh√¥ng c√≥ gi·ªõi h·∫°n b·ªô nh·ªõ (c√≥ th·ªÉ g√¢y out-of-memory)
    - alert: ContainerNoMemoryLimit
      expr: container_spec_memory_limit_bytes == 0
      for: 2m
      labels:
        severity: critical
      annotations:
        summary: "Container kh√¥ng c√≥ gi·ªõi h·∫°n b·ªô nh·ªõ"
        description: "M·ªôt container kh√¥ng c·∫•u h√¨nh gi·ªõi h·∫°n b·ªô nh·ªõ."

    ## ‚ö†Ô∏è 6. Disk c·ªßa host d√πng > 90%
    - alert: DiskUsageHigh
      expr: (node_filesystem_size_bytes{fstype!~"tmpfs|overlay"} - node_filesystem_free_bytes{fstype!~"tmpfs|overlay"})
             / node_filesystem_size_bytes{fstype!~"tmpfs|overlay"} > 0.9
      for: 2m
      labels:
        severity: warning
      annotations:
        summary: "Disk tr√™n host ƒë·∫ßy"
        description: "·ªî ƒëƒ©a tr√™n host s·ª≠ d·ª•ng v∆∞·ª£t qu√° 90%."

    ## ‚ö†Ô∏è 7. Docker daemon restart (c√≥ th·ªÉ ·∫£nh h∆∞·ªüng to√†n b·ªô container)
    - alert: DockerDaemonRestart
      expr: time() - container_last_seen > 300
      for: 1m
      labels:
        severity: critical
      annotations:
        summary: "Docker daemon c√≥ th·ªÉ ƒë√£ restart"
        description: "Container kh√¥ng c·∫≠p nh·∫≠t metrics trong 5 ph√∫t g·∫ßn nh·∫•t."

